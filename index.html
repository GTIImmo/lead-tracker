document.addEventListener("DOMContentLoaded", function() {
    const params = new URLSearchParams(window.location.search);
    
    // Correspondance exacte avec les colonnes Google Sheets
    const fields = {
        "Nom": "nom",
        "Prénom": "prenom",
        "Email": "email",
        "Téléphone": "telephone",
        "Adresse": "adresse",
        "Code Postal": "codePostal",
        "Ville": "ville",
        "Type de Bien": "typeBien",
        "Surface": "surface",
        "Nombre de Pièces": "nbPieces",
        "Prix": "prix"
    };

    let hasEditableFields = false;

    Object.keys(fields).forEach(colName => {
        let paramKey = fields[colName]; // Récupère la clé URL correspondante
        let value = decodeURIComponent(params.get(paramKey) || "");
        
        let span = document.getElementById(paramKey);
        let input = document.getElementById(paramKey + "Input");

        if (value) {
            span.textContent = value;
        } else {
            input.style.display = "inline-block";
            span.style.display = "none";
            hasEditableFields = true;
        }
    });

    if (hasEditableFields) {
        document.getElementById("saveChangesBtn").style.display = "block";
    }

    document.getElementById("saveChangesBtn").addEventListener("click", function() {
        let updatedData = { action: "update", row: params.get("row") };

        Object.keys(fields).forEach(colName => {
            let paramKey = fields[colName]; 
            let input = document.getElementById(paramKey + "Input");
            
            if (input && input.style.display === "inline-block" && input.value) {
                updatedData[colName] = input.value; // Utilisation du **nom exact de la colonne**
            }
        });

        let queryString = new URLSearchParams(updatedData).toString();
        let url = `https://script.google.com/macros/s/AKfycbx8jhzit3sZ1paGd6XsYCasKn_629u258n9fO5PNP6FmjXfFC6WvUGuvT_2RRQZ93IVxA/exec?${queryString}`;
        
        fetch(url)
            .then(response => response.text())
            .then(result => {
                alert("✅ Modifications enregistrées !");
                location.reload();
            })
            .catch(error => console.error("❌ Erreur :", error));
    });
});
