function doGet(e) {
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Leads Cityscan");
    var rowIndex = parseInt(e.parameter.row, 10);
    var action = e.parameter.action;
    var header = sheet.getDataRange().getValues()[0];

    if (!e || !e.parameter || !e.parameter.row) {
        Logger.log("‚ùå Erreur : Aucun param√®tre re√ßu !");
        return ContentService.createTextOutput("‚ùå Erreur : Aucun param√®tre re√ßu.").setMimeType(ContentService.MimeType.TEXT);
    }

    if (isNaN(rowIndex) || rowIndex < 2) {
        Logger.log("‚ùå Erreur : Ligne invalide :", rowIndex);
        return ContentService.createTextOutput("‚ùå Erreur : Ligne invalide").setMimeType(ContentService.MimeType.TEXT);
    }

    Logger.log("üîç Param√®tres re√ßus :", e.parameter);

    if (action === "update") {
        var editableFields = ["Nom", "Pr√©nom", "Email", "T√©l√©phone", "Statut RDV", "RDV"];
        var updates = [];
        
        for (var key in e.parameter) {
            if (key !== "action" && key !== "row") {
                var colIndex = header.indexOf(key);
                
                if (colIndex > -1 && editableFields.includes(key)) {
                    Logger.log(`‚úÖ Mise √† jour : Colonne '${key}' trouv√©e en position ${colIndex + 1}, nouvelle valeur : '${e.parameter[key]}'`);
                    sheet.getRange(rowIndex, colIndex + 1).setValue(e.parameter[key]);
                    updates.push(key);
                } else {
                    Logger.log(`‚ö†Ô∏è Cl√© '${key}' non trouv√©e dans le fichier Google Sheets.`);
                }
            }
        }

        if (updates.length === 0) {
            Logger.log("‚ùå Aucun champ mis √† jour !");
            return ContentService.createTextOutput("‚ùå Erreur : Aucune mise √† jour effectu√©e.").setMimeType(ContentService.MimeType.TEXT);
        }

        return ContentService.createTextOutput("‚úÖ Mise √† jour effectu√©e : " + updates.join(", ")).setMimeType(ContentService.MimeType.TEXT);
    }

    return ContentService.createTextOutput("‚ùå Action inconnue").setMimeType(ContentService.MimeType.TEXT);
}
